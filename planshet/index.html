<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#000000">
<title>PhotoClock Launcher</title>
<link rel="manifest" href="manifest.json">
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
  color: white;
  font-family: "Segoe UI", sans-serif;
}

#bg {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  object-fit: cover;
  z-index: 0;
}

.glass3d {
  --filter-glass3d: blur(15px) brightness(1) saturate(1);
  --color-glass3d: hsl(178 76% 16% / 0.1);
  --noise-glass3d: url("https://www.transparenttextures.com/patterns/egg-shell.png");

  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  box-shadow:
    0 0 0.75px hsl(205 20% 10% / 0.2),
    0.7px 0.8px 1.2px -0.4px hsl(205 20% 10% / 0.1),
    1.3px 1.5px 2.2px -0.8px hsl(205 20% 10% / 0.1),
    2.3px 2.6px 3.9px -1.2px hsl(205 20% 10% / 0.1),
    3.9px 4.4px 6.6px -1.7px hsl(205 20% 10% / 0.1),
    6.5px 7.2px 10.9px -2.1px hsl(205 20% 10% / 0.1),
    8px 9px 14px -2.5px hsl(205 20% 10% / 0.2);
}
.glass3d::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  border-radius: inherit;
  overflow: hidden;
  z-index: 3;
  -webkit-backdrop-filter: var(--filter-glass3d);
  backdrop-filter: var(--filter-glass3d);
  background-color: var(--color-glass3d);
  background-image: var(--noise-glass3d);
  background-size: 100px;
  background-repeat: repeat;
}
.glass3d::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  border-radius: inherit;
  overflow: hidden;
  z-index: 5;
  box-shadow:
    inset 2px 2px 1px -3px hsl(205 20% 90% / 0.8),
    inset 4px 4px 2px -6px hsl(205 20% 90% / 0.3),
    inset 1.5px 1.5px 1.5px -0.75px hsl(205 20% 90% / 0.15),
    inset 1.5px 1.5px 0.25px hsl(205 20% 90% / 0.03),
    inset 0 0 0.25px 0.5px hsl(205 20% 90% / 0.03);
}
.glass3d > * { position: relative; z-index: 6; }

#info {
  padding: 16px;
  text-align: center;
  font-size: 20px;
}

#clock {
  font-size: 36px;
  font-weight: bold;
}

#date {
  font-size: 18px;
  opacity: 0.85;
  margin-top: 4px;
}

#weather {
  display: flex;
  justify-content: center;
  gap: 80px;
  margin-top: 10px;
}

#weather div {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 18px;
}

#weather .temp {
  font-weight: bold;
}

#select-btn {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.4);
  border: none;
  color: white;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 14px;
  z-index: 10;
}
</style>
</head>
<body>

<input type="file" id="fileInput" accept="image/*" hidden>
<button id="select-btn">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
<img id="bg">

<div class="glass3d" id="glass">
  <div id="info">
    <div id="clock">00:00:00</div>
    <div id="date">1 —è–Ω–≤–∞—Ä—è 1970</div>
    <div id="weather">
      <div><div>–£—Ç—Ä–æ</div><div class="temp" id="morn">--¬∞ (--¬∞)</div></div>
      <div><div>–î–µ–Ω—å</div><div class="temp" id="day">--¬∞ (--¬∞)</div></div>
      <div><div>–í–µ—á–µ—Ä</div><div class="temp" id="eve">--¬∞ (--¬∞)</div></div>
      <div><div>–ù–æ—á—å</div><div class="temp" id="night">--¬∞ (--¬∞)</div></div>
    </div>
  </div>
</div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

const fileInput = document.getElementById('fileInput');
const bg = document.getElementById('bg');
const btn = document.getElementById('select-btn');

btn.onclick = () => fileInput.click();

fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    bg.src = ev.target.result; // base64 –±–µ–∑–æ–ø–∞—Å–Ω–æ, –±–µ–∑ blob
  };
  reader.readAsDataURL(file);
};

// üïí –ß–∞—Å—ã –∏ –¥–∞—Ç–∞
function updateClock() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2, '0');
  const m = String(now.getMinutes()).padStart(2, '0');
  const s = String(now.getSeconds()).padStart(2, '0');
  document.getElementById('clock').textContent = `${h}:${m}:${s}`;

  const months = ["—è–Ω–≤–∞—Ä—è","—Ñ–µ–≤—Ä–∞–ª—è","–º–∞—Ä—Ç–∞","–∞–ø—Ä–µ–ª—è","–º–∞—è","–∏—é–Ω—è","–∏—é–ª—è",
                  "–∞–≤–≥—É—Å—Ç–∞","—Å–µ–Ω—Ç—è–±—Ä—è","–æ–∫—Ç—è–±—Ä—è","–Ω–æ—è–±—Ä—è","–¥–µ–∫–∞–±—Ä—è"];
  const d = now.getDate();
  const mo = months[now.getMonth()];
  const y = now.getFullYear();
  document.getElementById('date').textContent = `${d} ${mo} ${y}`;
}
setInterval(updateClock, 1000);
updateClock();

// üå¶ –ü–æ–≥–æ–¥–∞ –ø–æ –ú–æ—Å–∫–≤–µ
const API = "a4c685c23cd9f959b37857f2d6a3625f";
function updateWeather() {
  fetch(`https://api.openweathermap.org/data/2.5/forecast?q=Moscow&appid=${API}&units=metric&lang=ru`)
    .then(r => r.json())
    .then(data => {
      if (!data || !data.list) return;
      const times = {morn: 6, day: 12, eve: 18, night: 0};
      for (const [id, hour] of Object.entries(times)) {
        const entry = data.list.find(x => new Date(x.dt * 1000).getHours() === hour);
        if (entry) {
          const temp = Math.round(entry.main.temp);
          const feels = Math.round(entry.main.feels_like);
          document.getElementById(id).textContent = `${temp}¬∞ (${feels}¬∞)`;
        }
      }
    })
    .catch(() => {});
}
updateWeather();
setInterval(updateWeather, 60 * 60 * 1000);
</script>

</body>
</html>
